!function(t,o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):t.Maplace=o(t.jQuery)}(this,function(l){"use strict";function t(t){this.VERSION="0.2.10",this.loaded=!1,this.markers=[],this.circles=[],this.oMap=!1,this.view_all_key="all",this.infowindow=null,this.maxZIndex=0,this.ln=0,this.oMap=!1,this.oBounds=null,this.map_div=null,this.canvas_map=null,this.controls_wrapper=null,this.current_control=null,this.current_index=null,this.Polyline=null,this.Polygon=null,this.Fusion=null,this.directionsService=null,this.directionsDisplay=null,this.o={debug:!1,map_div:"#gmap",controls_div:"#controls",generate_controls:!0,controls_type:"dropdown",controls_cssclass:"",controls_title:"",controls_on_map:!0,controls_applycss:!0,controls_position:google.maps.ControlPosition.RIGHT_TOP,type:"marker",view_all:!0,view_all_text:"View All",pan_on_click:!0,start:0,locations:[],shared:{},map_options:{mapTypeId:google.maps.MapTypeId.ROADMAP},stroke_options:{strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.4},directions_options:{travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC,optimizeWaypoints:!1,provideRouteAlternatives:!1,avoidHighways:!1,avoidTolls:!1},circle_options:{radius:100,visible:!0},styles:{},fusion_options:{},directions_panel:null,draggable:!1,editable:!1,show_infowindows:!0,show_markers:!0,infowindow_type:"bubble",listeners:{},beforeViewAll:function(){},afterViewAll:function(){},beforeShow:function(t,o,i){},afterShow:function(t,o,i){},afterCreateMarker:function(t,o,i){},beforeCloseInfowindow:function(t,o){},afterCloseInfowindow:function(t,o){},beforeOpenInfowindow:function(t,o,i){},afterOpenInfowindow:function(t,o,i){},afterRoute:function(t,o,i){},onPolylineClick:function(t){},onPolygonClick:function(t){},circleRadiusChanged:function(t,o,i){},circleCenterChanged:function(t,o,i){},drag:function(t,o,i){},dragEnd:function(t,o,i){},dragStart:function(t,o,i){}},this.AddControl("dropdown",o),this.AddControl("list",e),t&&"directions"===t.type&&(!t.show_markers&&(t.show_markers=!1),!t.show_infowindows&&(t.show_infowindows=!1)),l.extend(!0,this.o,t)}var o,e;return o={activateCurrent:function(t){this.html_element.find("select").val(t)},getHtml:function(){var t,o,i=this,e="";if(1<this.ln){for(e+='<select class="dropdown controls '+this.o.controls_cssclass+'">',this.ShowOnMenu(this.view_all_key)&&(e+='<option value="'+this.view_all_key+'">'+this.o.view_all_text+"</option>"),o=0;o<this.ln;o+=1)this.ShowOnMenu(o)&&(e+='<option value="'+(o+1)+'">'+(this.o.locations[o].title||"#"+(o+1))+"</option>");e=l(e+="</select>").bind("change",function(){i.ViewOnMap(this.value)})}return t=this.o.controls_title,this.o.controls_title&&(t=l('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",fontSize:this.o.controls_on_map?"12px":"inherit",padding:"3px 10px 5px 0"}:{}).append(this.o.controls_title)),this.html_element=l('<div class="wrap_controls"></div>').append(t).append(e),this.html_element}},e={html_a:function(t,o,i){var e=this,s=o||t+1,n=i||this.o.locations[t].title,a=l('<a data-load="'+s+'" id="ullist_a_'+s+'" href="#'+s+'" title="'+n+'"><span>'+(n||"#"+(t+1))+"</span></a>");return a.css(this.o.controls_applycss?{color:"#666",display:"block",padding:"5px",fontSize:this.o.controls_on_map?"12px":"inherit",textDecoration:"none"}:{}),a.on("click",function(t){t.preventDefault();var o=l(this).attr("data-load");e.ViewOnMap(o)}),a},activateCurrent:function(t){this.html_element.find("li").removeClass("active"),this.html_element.find("#ullist_a_"+t).parent().addClass("active")},getHtml:function(){var t,o,i=l("<ul class='ullist controls "+this.o.controls_cssclass+"'></ul>").css(this.o.controls_applycss?{margin:0,padding:0,listStyleType:"none"}:{});for(this.ShowOnMenu(this.view_all_key)&&i.append(l("<li></li>").append(e.html_a.call(this,!1,this.view_all_key,this.o.view_all_text))),o=0;o<this.ln;o++)this.ShowOnMenu(o)&&i.append(l("<li></li>").append(e.html_a.call(this,o)));return t=this.o.controls_title,this.o.controls_title&&(t=l('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",padding:"3px 10px 5px 0",fontSize:this.o.controls_on_map?"12px":"inherit"}:{}).append(this.o.controls_title)),this.html_element=l('<div class="wrap_controls"></div>').append(t).append(i),this.html_element}},t.prototype.controls={},t.prototype.create_objMap=function(){var t,o=0;for(t in this.o.styles)this.o.styles.hasOwnProperty(t)&&(0===o&&(this.o.map_options.mapTypeControlOptions={mapTypeIds:[google.maps.MapTypeId.ROADMAP]}),o++,this.o.map_options.mapTypeControlOptions.mapTypeIds.push("map_style_"+o));if(this.loaded)this.oMap.setOptions(this.o.map_options);else try{this.map_div.css({position:"relative",overflow:"hidden"}),this.canvas_map=l("<div>").addClass("canvas_map").css({width:"100%",height:"100%"}).appendTo(this.map_div),this.oMap=new google.maps.Map(this.canvas_map.get(0),this.o.map_options)}catch(t){this.debug("create_objMap::"+this.map_div.selector,t.toString())}for(t in o=0,this.o.styles)this.o.styles.hasOwnProperty(t)&&(o++,this.oMap.mapTypes.set("map_style_"+o,new google.maps.StyledMapType(this.o.styles[t],{name:t})),this.oMap.setMapTypeId("map_style_"+o))},t.prototype.add_markers_to_objMap=function(){var t,o,i=this.o.type||"marker";switch(i){case"marker":for(t=0;t<this.ln;t++)o=this.create_objPoint(t),this.create.marker.call(this,t,o);break;default:this.create[i].apply(this)}},t.prototype.create_objPoint=function(t){var o=l.extend({},this.o.locations[t]),i=void 0===o.visible?void 0:o.visible;return!o.type&&(o.type=this.o.type),o.map=this.oMap,o.position=new google.maps.LatLng(o.lat,o.lon),o.zIndex=void 0===o.zIndex?1e4:o.zIndex+100,o.visible=void 0===i?this.o.show_markers:i,this.o.maxZIndex=o.zIndex>this.maxZIndex?o.zIndex:this.maxZIndex,o.image&&(o.icon=new google.maps.MarkerImage(o.image,new google.maps.Size(o.image_w||32,o.image_h||32),new google.maps.Point(0,0),new google.maps.Point((o.image_w||32)/2,(o.image_h||32)/2))),o},t.prototype.create_objCircle=function(t){var o,i,e;return e=l.extend({},t),o=l.extend({},this.o.stroke_options),i=l.extend({},this.o.circle_options),l.extend(o,t.stroke_options||{}),l.extend(e,o),l.extend(i,t.circle_options||{}),l.extend(e,i),e.center=t.position,e.draggable=!1,e.zIndex=0<t.zIndex?t.zIndex-10:1,e},t.prototype.add_markerEv=function(o,i,e){var s=this;google.maps.event.addListener(e,"click",function(t){s.CloseInfoWindow(),s.o.beforeShow.call(s,o,i,e),s.o.show_infowindows&&!1!==i.show_infowindow&&s.open_infowindow(o,e,t),s.o.pan_on_click&&!1!==i.pan_on_click&&(s.oMap.panTo(i.position),i.zoom&&s.oMap.setZoom(i.zoom)),s.current_control&&s.o.generate_controls&&s.current_control.activateCurrent&&s.current_control.activateCurrent.call(s,o+1),s.current_index=o,s.o.afterShow.call(s,o,i,e)}),i.draggable&&this.add_dragEv(o,i,e)},t.prototype.add_circleEv=function(t,o,i){var e=this;google.maps.event.addListener(i,"click",function(){e.ViewOnMap(t+1)}),google.maps.event.addListener(i,"center_changed",function(){e.o.circleCenterChanged.call(e,t,o,i)}),google.maps.event.addListener(i,"radius_changed",function(){e.o.circleRadiusChanged.call(e,t,o,i)}),o.draggable&&this.add_dragEv(t,o,i)},t.prototype.add_dragEv=function(a,r,l){var h=this;google.maps.event.addListener(l,"drag",function(t){var o,i;if(l.getPosition)o=l.getPosition();else{if(!l.getCenter)return;o=l.getCenter()}if(h.circles[a]&&h.circles[a].setCenter(o),h.Polyline?i="Polyline":h.Polygon&&(i="Polygon"),i){for(var e=h[i].getPath().getArray(),s=[],n=0;n<e.length;++n)s[n]=a===n?new google.maps.LatLng(o.lat(),o.lng()):new google.maps.LatLng(e[n].lat(),e[n].lng());h[i].setPath(new google.maps.MVCArray(s)),h.add_polyEv(i)}h.o.drag.call(h,a,r,l)}),google.maps.event.addListener(l,"dragend",function(){h.o.dragEnd.call(h,a,r,l)}),google.maps.event.addListener(l,"dragstart",function(){h.o.dragStart.call(h,a,r,l)}),google.maps.event.addListener(l,"center_changed",function(){h.markers[a]&&l.getCenter&&h.markers[a].setPosition(l.getCenter()),h.o.drag.call(h,a,r,l)})},t.prototype.add_polyEv=function(i){var e=this;google.maps.event.addListener(this[i].getPath(),"set_at",function(t,o){e.trigger_polyEv(i,t,o)}),google.maps.event.addListener(this[i].getPath(),"insert_at",function(t,o){e.trigger_polyEv(i,t,o)})},t.prototype.trigger_polyEv=function(t,o,i){var e=this[t].getPath().getAt(o),s=new google.maps.LatLng(e.lat(),e.lng());this.markers[o]&&this.markers[o].setPosition(s),this.circles[o]&&this.circles[o].setCenter(s),this.o["on"+t+"Changed"](o,i,this[t].getPath().getArray())},t.prototype.create={marker:function(t,o,i){if("circle"===o.type&&!i){var e=this.create_objCircle(o);o.visible||(e.draggable=o.draggable),i=new google.maps.Circle(e),this.add_circleEv(t,e,i),this.circles[t]=i}return o.type="marker",i=new google.maps.Marker(o),this.add_markerEv(t,o,i),this.oBounds.extend(o.position),this.markers[t]=i,this.o.afterCreateMarker.call(this,t,o,i),i},circle:function(){var t,o,i,e;for(t=0;t<this.ln;t++)"circle"===(o=this.create_objPoint(t)).type&&(i=this.create_objCircle(o),o.visible||(i.draggable=o.draggable),e=new google.maps.Circle(i),this.add_circleEv(t,i,e),this.circles[t]=e),o.type="marker",this.create.marker.call(this,t,o,e)},polyline:function(){var t,o,i=l.extend({},this.o.stroke_options);for(i.path=[],i.draggable=this.o.draggable,i.editable=this.o.editable,i.map=this.oMap,i.zIndex=this.o.maxZIndex+100,t=0;t<this.ln;t++)o=this.create_objPoint(t),this.create.marker.call(this,t,o),i.path.push(o.position);this.Polyline?this.Polyline.setOptions(i):this.Polyline=new google.maps.Polyline(i),this.add_polyEv("Polyline")},polygon:function(){var t,o,i=this,e=l.extend({},this.o.stroke_options);for(e.path=[],e.draggable=this.o.draggable,e.editable=this.o.editable,e.map=this.oMap,e.zIndex=this.o.maxZIndex+100,t=0;t<this.ln;t++)o=this.create_objPoint(t),this.create.marker.call(this,t,o),e.path.push(o.position);this.Polygon?this.Polygon.setOptions(e):this.Polygon=new google.maps.Polygon(e),google.maps.event.addListener(this.Polygon,"click",function(t){i.o.onPolygonClick.call(i,t)}),this.add_polyEv("Polygon")},fusion:function(){this.o.fusion_options.styles=[this.o.stroke_options],this.o.fusion_options.map=this.oMap,this.Fusion?this.Fusion.setOptions(this.o.fusion_options):this.Fusion=new google.maps.FusionTablesLayer(this.o.fusion_options)},directions:function(){var t,o,i,e,s,n=this,a=[],r=0;for(t=0;t<this.ln;t++)o=this.create_objPoint(t),0===t?e=o.position:t===this.ln-1?s=o.position:(i=!0===this.o.locations[t].stopover,a.push({location:o.position,stopover:i})),this.create.marker.call(this,t,o);this.o.directions_options.origin=e,this.o.directions_options.destination=s,this.o.directions_options.waypoints=a,this.directionsService||(this.directionsService=new google.maps.DirectionsService),this.directionsDisplay?this.directionsDisplay.setOptions({draggable:this.o.draggable}):this.directionsDisplay=new google.maps.DirectionsRenderer({draggable:this.o.draggable}),this.directionsDisplay.setMap(this.oMap),this.o.directions_panel&&(this.o.directions_panel=l(this.o.directions_panel),this.directionsDisplay.setPanel(this.o.directions_panel.get(0))),this.o.draggable&&google.maps.event.addListener(this.directionsDisplay,"directions_changed",function(){var t=n.directionsDisplay.getDirections();r=n.compute_distance(n.directionsDisplay.directions),n.o.afterRoute.call(n,r,t.status,t)}),this.directionsService.route(this.o.directions_options,function(t,o){o===google.maps.DirectionsStatus.OK&&(r=n.compute_distance(t),n.directionsDisplay.setDirections(t)),n.o.afterRoute.call(n,r,o,t)})}},t.prototype.compute_distance=function(t){var o,i=0,e=t.routes[0],s=e.legs.length;for(o=0;o<s;o++)i+=e.legs[o].distance.value;return i},t.prototype.type_to_open={bubble:function(t){var o=this,i={content:t.html||""};t.infoWindowMaxWidth&&(i.maxWidth=t.infoWindowMaxWidth),this.infowindow=new google.maps.InfoWindow(i),google.maps.event.addListener(this.infowindow,"closeclick",function(){o.CloseInfoWindow()})}},t.prototype.open_infowindow=function(t,o,i){var e=this.o.locations[t],s=this.o.infowindow_type;e.html&&this.type_to_open[s]&&(this.o.beforeOpenInfowindow.call(this,t,e,o),this.type_to_open[s].call(this,e),this.infowindow.open(this.oMap,o),this.o.afterOpenInfowindow.call(this,t,e,o))},t.prototype.get_html_controls=function(){return this.controls[this.o.controls_type]&&this.controls[this.o.controls_type].getHtml?(this.current_control=this.controls[this.o.controls_type],this.current_control.getHtml.apply(this)):""},t.prototype.generate_controls=function(){if(!this.o.controls_on_map)return this.controls_wrapper.empty(),void this.controls_wrapper.append(this.get_html_controls());var t=l('<div class="on_gmap '+this.o.controls_type+' gmap_controls"></div>').css(this.o.controls_applycss?{margin:"5px"}:{}),o=l(this.get_html_controls()).css(this.o.controls_applycss?{background:"#fff",padding:"5px",border:"1px solid #eee",boxShadow:"rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px",maxHeight:this.map_div.find(".canvas_map").outerHeight()-80,minWidth:100,overflowY:"auto",overflowX:"hidden"}:{});t.append(o),this.oMap.controls[this.o.controls_position].clear(),this.oMap.controls[this.o.controls_position].push(t.get(0))},t.prototype.init_map=function(){var i=this;this.Polyline&&this.Polyline.setMap(null),this.Polygon&&this.Polygon.setMap(null),this.Fusion&&this.Fusion.setMap(null),this.directionsDisplay&&this.directionsDisplay.setMap(null);for(var t=this.markers.length-1;0<=t;t-=1)try{this.markers[t]&&this.markers[t].setMap(null)}catch(t){i.debug("init_map::markers::setMap",t.stack)}this.markers.length=0,this.markers=[];for(var o=this.circles.length-1;0<=o;o-=1)try{this.circles[o]&&this.circles[o].setMap(null)}catch(t){i.debug("init_map::circles::setMap",t.stack)}this.circles.length=0,this.circles=[],this.o.controls_on_map&&this.oMap.controls&&this.oMap.controls[this.o.controls_position].forEach(function(t,o){try{i.oMap.controls[this.o.controls_position].removeAt(o)}catch(t){i.debug("init_map::removeAt",t.stack)}}),this.oBounds=new google.maps.LatLngBounds},t.prototype.perform_load=function(){this.CloseInfoWindow(),1===this.ln?(this.o.map_options.set_center?this.oMap.setCenter(new google.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):(this.oMap.fitBounds(this.oBounds),this.ViewOnMap(1)),this.o.map_options.zoom&&this.oMap.setZoom(this.o.map_options.zoom)):0===this.ln?(this.o.map_options.set_center?this.oMap.setCenter(new google.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):this.oMap.fitBounds(this.oBounds),this.oMap.setZoom(this.o.map_options.zoom||1)):(this.oMap.fitBounds(this.oBounds),"number"==typeof(this.o.start-0)&&0<this.o.start&&this.o.start<=this.ln?this.ViewOnMap(this.o.start):this.o.map_options.set_center?this.oMap.setCenter(new google.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):this.ViewOnMap(this.view_all_key),this.o.map_options.zoom&&this.oMap.setZoom(this.o.map_options.zoom))},t.prototype.debug=function(t,o){return this.o.debug&&console.log(t,o),this},t.prototype.AddControl=function(t,o){return t&&o?(this.controls[t]=o,this):(self.debug("AddControl",'Missing "name" and "func" callback.'),!1)},t.prototype.CloseInfoWindow=function(){return this.infowindow&&(this.current_index||0===this.current_index)&&(this.o.beforeCloseInfowindow.call(this,this.current_index,this.o.locations[this.current_index]),this.infowindow.close(),this.infowindow=null,this.o.afterCloseInfowindow.call(this,this.current_index,this.o.locations[this.current_index])),this},t.prototype.ShowOnMenu=function(t){if(t===this.view_all_key&&this.o.view_all&&1<this.ln)return!0;if("number"==typeof((t=parseInt(t,10))-0)&&0<=t&&t<this.ln&&!1!==this.o.locations[t].on_menu)return!0;return!1},t.prototype.ViewOnMap=function(t){if(t===this.view_all_key)this.o.beforeViewAll.call(this),this.current_index=t,0<this.o.locations.length&&this.o.generate_controls&&this.current_control&&this.current_control.activateCurrent&&this.current_control.activateCurrent.apply(this,[t]),this.oMap.fitBounds(this.oBounds),this.o.afterViewAll.call(this);else if("number"==typeof((t=parseInt(t,10))-0)&&0<t&&t<=this.ln)try{google.maps.event.trigger(this.markers[t-1],"click")}catch(t){this.debug("ViewOnMap::trigger",t.stack)}return this},t.prototype.SetLocations=function(t,o){return this.o.locations=t,o&&this.Load(),this},t.prototype.AddLocations=function(t,o){var i=this;return l.isArray(t)&&l.each(t,function(t,o){i.o.locations.push(o)}),l.isPlainObject(t)&&this.o.locations.push(t),o&&this.Load(),this},t.prototype.AddLocation=function(t,o,i){return l.isPlainObject(t)&&this.o.locations.splice(o,0,t),i&&this.Load(),this},t.prototype.RemoveLocations=function(t,o){var i=this,e=0;return l.isArray(t)?l.each(t,function(t,o){o-e<i.ln&&i.o.locations.splice(o-e,1),e++}):t<this.ln&&this.o.locations.splice(t,1),o&&this.Load(),this},t.prototype.Loaded=function(){return this.loaded},t.prototype._init=function(){this.ln=this.o.locations.length;for(var t=0;t<this.ln;t++){var o=l.extend({},this.o.shared);this.o.locations[t]=l.extend(o,this.o.locations[t]),this.o.locations[t].html&&(this.o.locations[t].html=this.o.locations[t].html.replace("%index",t+1),this.o.locations[t].html=this.o.locations[t].html.replace("%title",this.o.locations[t].title||""))}return this.map_div=l(this.o.map_div),this.controls_wrapper=l(this.o.controls_div),this},t.prototype.Load=function(t){l.extend(!0,this.o,t),t&&t.locations&&(this.o.locations=t.locations),this._init(),!1===this.o.visualRefresh?google.maps.visualRefresh=!1:google.maps.visualRefresh=!0,this.init_map(),this.create_objMap(),this.add_markers_to_objMap(),1<this.ln&&this.o.generate_controls||this.o.force_generate_controls?(this.o.generate_controls=!0,this.generate_controls()):this.o.generate_controls=!1;var o=this;if(this.loaded)this.perform_load();else for(var i in google.maps.event.addListenerOnce(this.oMap,"idle",function(){o.perform_load()}),this.o.listeners)this.o.listeners.hasOwnProperty(i)&&google.maps.event.addListener(this.oMap,i,this.o.listeners[i]);return this.loaded=!0,this},t});